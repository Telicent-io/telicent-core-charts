apiVersion: v1
kind: Pod
metadata:
  name: {{ include "search-projector.fullname" . }}-test-connection
  labels:
    {{- include "search-projector.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: istio-403
      image: alpine/curl:8.1.14
      imagePullPolicy: IfNotPresent
      command: [ "/bin/sh", "-c" ]
      args:
        - |
          output="$(curl http://{{ include "search-projector.fullname" . }}.{{ .Release.Namespace }}.svc.cluster.local:{{ .Values.metrics.service.port }})"; \
          echo "$output" | grep "403"

  restartPolicy: Never
